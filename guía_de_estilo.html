<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Guía de estilo • metR</title>

<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
<!-- Bootstrap -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script>



<meta property="og:title" content="Guía de estilo" />

<meta property="og:image" content="/logo.png" />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


  </head>

  <body>
    <div class="container template-title-body">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">metR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="articles/Visualization-tools.html">Visualization tools</a>
    </li>
    <li>
      <a href="articles/Working-with-data.html">Working with data</a>
    </li>
  </ul>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/eliocamp/metR">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Guía de estilo</h1>
    </div>

<div id="guia-de-estilo" class="section level1">

<p>Para homogeneizar el código, voy a hacer y adoptar una guía de estilo además de algunas “buenas prácticas”. Está basada en la <a href="https://google.github.io/styleguide/Rguide.xml">guía de estilo de Google</a> y otras que fui encontrando.</p>
<div id="nombres" class="section level2">
<h2 class="hasAnchor">
<a href="#nombres" class="anchor"></a>Nombres</h2>
<p>Para evitar problemas con caracteres especiales (eñes, tildes) el nombre de las variables, funciones y columnas va en inglés.</p>
<pre class="{r}"><code># Bien
precipitation 
precipitation[, year := as.Date(date)]
pp &lt;- precipitation    # se pueden usar abreviaciones meteorológicas claras

# Mal
precipitación
precipitacion[, año := as.Date(fecha)]</code></pre>
<p>Los nombres de <strong>variables</strong> son en minúscula y deben ser sustantivos lo más descriptivos posible (¡pensar unos segundos antes de nombrar!). Están formados por un descriptor de las variables que tiene adentro y una serie de sufijos separados por “.”. El descriptor y los sufijos pueden usar "_" para separar.</p>
<p>El descriptor siempre va primero, seguido de los sufijos en orden de relevancia (usar el sentido común).</p>
<pre class="{r}"><code># Bien.
pp.ncep.l    # precipitación del modelo ncep en formato long
pp.np_sp.w    # precipitación del modelo ncep y del modelo speedy en formato long
cor.np_sp    # correlación entre ncep y speedy

# Aceptable.
ncep    # muchas variables del modelo ncep

# Mal.
pp_ncep
cor_ncep_speedy
ppNcepSpeedy    # ¡no usar CamelCase ni camelCase!</code></pre>
<div id="nombres-especiales" class="section level3">
<h3 class="hasAnchor">
<a href="#nombres-especiales" class="anchor"></a>Nombres especiales</h3>
<p>Para ser consistente entre distintas partes del código, estos son algunos nombres de variables que <strong>tienen</strong> que respetarse so pena de quilombo en el código y tener que acordarse muchos más nombres.</p>
<ul>
<li>Latitud y Longitud son <code>lat</code> y <code>lon</code>. No usar <code>long</code> como un troglodita (aunque técnicamente “long” significa largo, que no está tan lejos de “longitud”). La longitud va de 0 a 360 (para que sea más fácil proyectar con pacífico central) pero se la grafica en -180:180 (para eso, usar <code><a href="reference/scale_longitude.html">scale_x_longitude()</a></code> y <code><a href="reference/scale_longitude.html">scale_y_longitude()</a></code>).</li>
<li>La fecha es <code>time</code>. No usar <code>date</code> ni otra similar. El formato <strong>siempre</strong> debe ser YYYY-MM-DD HH:MM:SS. Siempre codificarlo como una clase <code>datetime</code> de lubridate.</li>
<li>Los meses <strong>siempre</strong> se codifican el 1 al 12 y como <code>factor</code> ordenado. Todavía no decido si conviene tener diciembre o enero como el primer mes.</li>
<li>
<p>Variables meteorológicas:</p>
<ul>
<li>
<strong>gh</strong>: altura geopotencial</li>
<li>
<strong>u</strong>: viento zonal</li>
<li>
<strong>v</strong>: viento meridional (no usar para viento o flujo que NO sea meridional)</li>
<li>
<strong>V</strong>: magnitud del viento</li>
<li>
<strong>angle</strong>: ángulo del viento</li>
<li>
<strong>t</strong>: temperatura</li>
<li>
<strong>pp</strong>: precipitación</li>
<li>
<strong>psi</strong>: función corriente</li>
<li>
<strong>sst</strong>: temperatura de la superficie del mar</li>
<li>
<strong>olr</strong>: onda larga saliente</li>
<li>
<strong>slp</strong>: presión sobre el nivel del mar</li>
</ul>
</li>
<li>
<p>Sufijos:</p>
<ul>
<li>
<strong>l</strong>: formato long (para dataframes)</li>
<li>
<strong>w</strong>: formato wide (para dataframes)</li>
<li>
<strong>t</strong>: anomalía temporal</li>
<li>
<strong>z</strong>: anomalía zonal</li>
<li>
<strong>int</strong>: interpolado</li>
</ul>
</li>
<li><p>Las derivadas se nombran agregando el sufijo <code>dx</code> al final de la variable. Derivadas de mayor orden se nombran repitiendo la coordenada que deriva (ej. <code>gh.dxx</code>). Las derivadas cruzadas se escriben siempre en orden x, y, z, t (ej. es <code>gh.dxy</code> en vez de <code>gh.dyx</code>).</p></li>
</ul>
<p>Como aclaración, es importante modificar todo dato leído de fuentes externas para que se ajuste a estos criterios. No hacer ni siquiera una conversión de unidades antes de tener los datos prolijos.</p>
<p>Si es neceario guardar datos en el disco (como resutlados de computaciones largas) usar siempre <code><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">saveRDS()</a></code> en vez de <code><a href="https://www.rdocumentation.org/packages/base/topics/save">save()</a></code> y la extensión es “.Rds”.</p>
<pre class="{r}"><code># Bien.
regr.sst_gh &lt;- lm(...)
saveRDS(regr.sst_gh, file = "regr.sst_gh.Rds")

# Mal.
regr.sst_gh &lt;- lm(...)
saveRDS(regr.sst_gh, file = "regresion.rds")</code></pre>
<p>Los nombres de <strong>funciones</strong> van con CamelCase y sin puntos. Deben ser descriptivas (nuevamente, ¡pensar un segundo antes de nombrar!) y, en lo posible, verbos. Dos excepciones:</p>
<ul>
<li><p>Si el verbo es “calculate”, se puede omitir</p></li>
<li><p>Las funciones que convierten de un tipo de variable a otro se esciben en minúscula con el formato “[entrada]2[salida]”</p></li>
</ul>
<p>A menos que sea demasiado obvio qué es lo que hace la función, agregar una descripción del funcionamiento, argumentos de entrada, salida y aclaraciones pertinentes sobre limitaciones y errores. Esta documentación debe estar en la primera línea de la función. El orden de los argumentos debe ser razonable y siempre tratando de que el primero sea el “dato” que uno quiere manipular de manera que sea compatible con el <em>pipe</em> (<code>%&gt;%</code>). El nombre de los argumentos tiene que ser descriptivo. Explicitar el valor devuelto con <code><a href="https://www.rdocumentation.org/packages/base/topics/function">return()</a></code> a menos que la función sea un <em>wrapper</em> de otra función con argumentos por default que se usan seguido.</p>
<pre class="{r}"><code># Bien.
date2month &lt;- function(date) {
      # Extrae el mes a partir de una fecha en formato YYYY-MM-DD.
      # Entra: 
      #   date: la fecha
      # Sale:
      #   el mes, como factor ordenado
    
    ...
    return(month)
}

# Bien.
# No hace falta documentación ni return ya que es obvio lo que hace. 
# Nombre alternativo: CalculateAnomaly.  
Anomaly &lt;- function(x) {
    as.numeric(scale(x, scale = FALSE))
}

# Mal.
convertir_fecha &lt;- function(x) {
    as.Date(x)
}</code></pre>
<p>Los nombres de los argumentos van en minúscula y usa “.” para separación.</p>
</div>
</div>
<div id="sintaxis" class="section level2">
<h2 class="hasAnchor">
<a href="#sintaxis" class="anchor"></a>Sintaxis</h2>
<p>Usar espacios alrededor de: <code>=</code>, <code>==</code> , <code>+</code>, <code>-</code>, <code>&lt;-</code>, <code>^</code>.</p>
<p>No usar espacios alrededor de: <code>*</code>, <code>/</code>, <code>^</code>, <code>:</code>, <code>::</code></p>
<p>(listas sujetas a ampliación a medida que se me vayan ocurriendo casos)</p>
<p>No poner espacio antes de la coma pero sí después de la coma. Poner espacios antes de los paréntesis y las llaves excepto al llamar funciones.</p>
<pre class="{r}"><code># Bien.
pp.std_anom_sqr &lt;- ((pp - pp.mean)/sd(pp))^2
pp[1, 2]
pp[1, ]

value.one    &lt;- 1
value.second &lt;- 2

x &lt;- 1:10

# Mal.
pp.std_anom &lt;- ( pp-pp.mean ) / sd (pp)

if(i==1){
    x&lt;-3
}

x &lt;- 1 : 10</code></pre>
<p>Los corchetes de apertura nunca van en su propia línea y deben ser seguidos por una nueva línea. El corchete de cierre va en su propia línea a menos que esté seguido por <code>else</code>.</p>
<pre class="{r}"><code># Bien.
if (i == 1) {
    x &lt;- 3
} else {
    x &lt;- 5
} 

if (i == 5) stop("i = 5!")    # se pueden obviar las llaves si es algo corto 

# Mal.
if (i == 1) 
{
    x &lt;- 3}

if (i == 5) 
    stop("i = 5!") knit</code></pre>
<p>Usar <code>&lt;-</code> para asignación (esto es lo más controversial de la guía ya que hubiera preferido aprender R usando <code>=</code>; pero lo hecho hecho está y el código usando <code>=</code> me resulta feo).</p>
<p>Respetar la identación usando 4 espacios. Se puede poner espaciado extra para alinear asignación de varias variables o la asiganción de muchos argumentos en una función. Acá está bien ser flexible si el código termina con demasiado espaciado innecesario. Algunos ejempos donde puede obviarse es al usar <code><a href="https://www.rdocumentation.org/packages/base/topics/invisible">invisible()</a></code> para arreglar los problemas entre data.table y knitr o código muy largo dentro del <em>j</em> de un data.table.</p>
<p>Usar nuevas líneas para estructurar el código. Tratar el código como si fuera texto y separarlo en párrafos con una temática consistente. Por ejemplo, líneas donde se lee y prepara una fuente de datos, por ejemplo, van todos juntos, pero separados de otro bloque donde se leen otros datos.</p>
<p>Los <strong>comentarios</strong> pueden ir en su propia línea o en una línea de código. En el primer caso, empiezan con sólo un “#” y un espacio y se escriben en mayúscula y terminando con un punto (como si fuera una oración normal de toda la vida). En el segundo caso, se separan del código con 4 espacios y un “#” y van en minúscula y sin punto final.</p>
</div>
<div id="buenas-practicas" class="section level2">
<h2 class="hasAnchor">
<a href="#buenas-practicas" class="anchor"></a>Buenas prácticas</h2>
<p>Consejos que no tienen que ver con el estilo sino con cómo programar.</p>
<div id="variables-temporales" class="section level3">
<h3 class="hasAnchor">
<a href="#variables-temporales" class="anchor"></a>Variables temporales</h3>
<p>En lo posible, usar el operador <code>%&gt;%</code> para evitarlas. Si no se puede, usar siempre el nombre <code>temp</code> de manera de sobreescribirla y que el enviroment no se llene de porquerías. Al mismo tiempo, tratar de que en lo posible cada línea de código pueda ser corrida varias veces seguidas sin generar problemas.</p>
<pre class="{r}"><code># Bien.
x &lt;- 5
y &lt;- x + 5

ncep[, time := paste0(year, month, day, sep = "-")]

ice.grid &lt;- readBin(...) %&gt;%
    melt() %&gt;%
    as.data.table()
    

# Mal.
x &lt;- 5
x &lt;- x + 5    # si se me ocurre correr de nuevo esta línea, el valor de x no es el deseado

ncep[, year := paste0(year, month, day, sep = "-")]

ice.grid.temp &lt;- readBin(...)
ice.grid.temp &lt;- melt(ice.grid.temp)    # particularmente malo!
ice.grid &lt;- as.data.table(ice.grid.temp)    # no tan malo. </code></pre>
<p>A veces es necesario hacer alguna modificación de los datos únicamente para graficar. En ese caso, evitar realizar la computación dentro de la llamada a <code>ggplot()</code>; en cambio, hacerla en la línea anterior asignando el nombre <code>gdata</code>. Dado que es una variable “temporal”, al usar siempre el mismo nombre uno se asegura de que se sobreescriba y no se llene el enviroment de porquerías.</p>
</div>
</div>
</div>

  </div>

</div>


      <footer>
      <div class="copyright">
  <p>Developed by Elio Campitelli.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
   </div>

  

  </body>
</html>

