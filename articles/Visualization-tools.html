<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Visualization tools • metR</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Visualization tools">
<meta property="og:description" content="metR">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">metR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.7.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Visualization-tools.html">Visualization tools</a>
    </li>
    <li>
      <a href="../articles/Working-with-data.html">Working with data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/eliocamp/metR/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Visualization tools</h1>
                        <h4 class="author">Elio Campitelli</h4>
            
            <h4 class="date">2020-07-29</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/eliocamp/metR/blob/master/vignettes/Visualization-tools.Rmd"><code>vignettes/Visualization-tools.Rmd</code></a></small>
      <div class="hidden name"><code>Visualization-tools.Rmd</code></div>

    </div>

    
    
<p>One of the “conceptual branches” of <code>metR</code> is the <em>visualization tools</em>. These are a set of functions that interface with <a href="http://ggplot2.tidyverse.org/index.html">ggplot2</a> for easier and better plotting of meteorological (an other) fields.</p>
<div id="scales" class="section level1">
<h1 class="hasAnchor">
<a href="#scales" class="anchor"></a>Scales</h1>
<p>Many meteorological fields are defined in a longitude×latitude×level grid, so <code>metR</code> includes scales for each dimension. These are glorified wrappers around <code>scale_*_continuous()</code> with sensible defaults and, in the case of <code>scale_*_level()</code>, the implementation of <code><a href="../reference/reverselog_trans.html">reverselog_trans()</a></code>.</p>
<p>There are also <code><a href="../reference/scale_divergent.html">scale_color_divergent()</a></code> and <code><a href="../reference/scale_divergent.html">scale_fill_divergent()</a></code> which are wrappers around <code>scale_*_gradient2()</code> but with sane default colours for positive and negative values –particularly useful for plotting anomaly values.</p>
<p>To see how this scales work, let’s visualize the vertical distribution of temperature anomalies from the zonal mean.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">metR</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">data.table</span>)
<span class="no">temperature</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/copy.html">copy</a></span>(<span class="no">temperature</span>)
<span class="no">temperature</span>[, <span class="no">air.z</span> <span class="kw">:=</span> <span class="fu"><a href="../reference/Anomaly.html">Anomaly</a></span>(<span class="no">air</span>), <span class="kw">by</span> <span class="kw">=</span> <span class="fu">.</span>(<span class="no">lat</span>, <span class="no">lev</span>)]

<span class="co"># Plot made with base ggplot</span>
(<span class="no">g</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lon</span> <span class="kw">%~%</span> <span class="fl">180</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lat</span>, <span class="no">lev</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">air.z</span>)) +
        <span class="fu"><a href="../reference/geom_contour2.html">geom_contour2</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">..level..</span>)))
<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span></pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<p>While this is fine, since pressure levels are roughly proportional to <span class="math inline">\(\mathrm{e}^{-z}\)</span> in meteorology we usually plot the vertical coordinate as <span class="math inline">\(-\log(p)\)</span>. However, while ggplot2 has <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_log10()</a></code> and <code><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html">scale_y_reverse()</a></code>, they don’t work together. <code>metR</code> defines the new transformation <code><a href="../reference/reverselog_trans.html">reverselog_trans()</a></code> that can be used with any scale but that is the default for <code>scale_*_level()</code>.</p>
<p>On the other hand, <code>scale_*_latitude()</code> (and <code>scale_*_longitude()</code>) not only defaults <code>expand</code> to <code><a href="https://rdrr.io/r/base/c.html">c(0, 0)</a></code>, but also has a <code>ticks</code> argument that specifies the spacing of breaks between -90 and 90 in the case of <code>scale_*_latitude()</code>, and between 0 and 360 in the case of <code>scale_*_longitude()</code>.</p>
<p>These scales default to printing no label, since usually the dimensions are understood by the shape of the plot.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">g</span> +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_level</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_x_latitude</a></span>(<span class="kw">ticks</span> <span class="kw">=</span> <span class="fl">15</span>, <span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">90</span>, <span class="fl">90</span>)) +
    <span class="fu"><a href="../reference/scale_divergent.html">scale_color_divergent</a></span>()
<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span></pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-2-1.png" width="672"></p>
<p>Note: <code>scale_*_longitude()</code> (currently) assumes the data goes from 0° to 360° but puts labels between -180° and 180°. This very idiosyncratic choice stems from the fact that model output is usually in the [0; 360) range but it’s easier to read maps in the (-180; 180] range. This may change in the future.</p>
</div>
<div id="geoms-and-stats" class="section level1">
<h1 class="hasAnchor">
<a href="#geoms-and-stats" class="anchor"></a>Geoms and stats</h1>
<div id="geom_contour_fill" class="section level2">
<h2 class="hasAnchor">
<a href="#geom_contour_fill" class="anchor"></a>geom_contour_fill()</h2>
<p>In ggplot2, the ‘canonical’ way to get filled contours is by using <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">stat_contour()</a></code> with a <code>polygon</code> geom and mapping <code>fill</code> to <code>level</code> (see <a href="https://github.com/tidyverse/ggplot2/issues/1066">this</a> issue), but this has three important limitations.</p>
<ul>
<li><p>It doesn’t work well for contours that end at the edges</p></li>
<li><p>External contours sometimes hide internal ones (small red contour in the figure below)</p></li>
<li><p>There’s no distinction between contours with the same level but different internal values (blue contours in the figure below)</p></li>
</ul>
<p><code><a href="../reference/geom_contour_fill.html">geom_contour_fill()</a></code> makes some adjustments to the data and computes an additional variable <code>int.level</code> (which is the default mapping for the <code>fill</code> aesthetic) that solve these problems.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">breaks</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">100</span>, <span class="fl">200</span>, <span class="kw">by</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="no">v</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/setDT.html">setDT</a></span>(<span class="kw pkg">reshape2</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/reshape2/man/melt.html">melt</a></span>(<span class="no">volcano</span>))
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">v</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">Var1</span>, <span class="no">Var2</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">value</span>)) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">stat_contour</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="no">..level..</span>), <span class="kw">geom</span> <span class="kw">=</span> <span class="st">"polygon"</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="no">breaks</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">geom_contour</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"red"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="fl">150</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">geom_contour</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"blue"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.2</span>, <span class="kw">breaks</span> <span class="kw">=</span> <span class="fl">160</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">"none"</span>)

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">v</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">Var1</span>, <span class="no">Var2</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">value</span>)) +
    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="no">breaks</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html">guides</a></span>(<span class="kw">fill</span> <span class="kw">=</span> <span class="st">"none"</span>)</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-3-1.png" width="316.8"><img src="Visualization-tools_files/figure-html/unnamed-chunk-3-2.png" width="316.8"></p>
<p>In principle, <code><a href="../reference/geom_contour_fill.html">geom_contour_fill()</a></code> needs a full regular grid with no missing values and by default with fail if otherwise. However it can automatically impute missing values. With the <code>na.fill</code> parameter you can have some control over the imputation of <code>NA</code>s. Setting it to <code>TRUE</code> will impute missing values with spline bivariate interpolation. Other options are passing a constant numeric value or a function that takes the vector of values and return one value (like <code>mean</code>).</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Adding missing values</span>
<span class="no">v</span>[, <span class="no">value.gap</span> <span class="kw">:=</span> <span class="no">value</span>]
<span class="no">v</span>[(<span class="no">Var1</span> - <span class="fl">40</span>)^<span class="fl">2</span> + (<span class="no">Var2</span> - <span class="fl">35</span>)^<span class="fl">2</span> <span class="kw">&lt;</span> <span class="fl">50</span>, <span class="no">value.gap</span> <span class="kw">:=</span> <span class="fl">NA</span>]

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">v</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">Var1</span>, <span class="no">Var2</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">value.gap</span>)) +
    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="no">breaks</span>, <span class="kw">na.fill</span> <span class="kw">=</span> <span class="fl">TRUE</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span>(<span class="kw">data</span> <span class="kw">=</span> <span class="no">v</span>[<span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">value.gap</span>)], <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.1</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">0.3</span>)
<span class="co">#&gt; Warning: imputing missing values</span></pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>It’s probably good practice to mask missing values with <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_raster()</a></code>. See <code><a href="../reference/stat_subset.html">stat_subset()</a></code> for a quick way of selecting missing values.</p>
<p>We can apply this to a more realistic dataset</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lev</span> <span class="kw">==</span> <span class="fl">300</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">air.z</span>)) +
    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>() +
    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_x_longitude</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_latitude</a></span>()</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<p>As an important note, this stat currently only works with rectangular grids.</p>
</div>
<div id="geom_text_contour-and-geom_label_contour" class="section level2">
<h2 class="hasAnchor">
<a href="#geom_text_contour-and-geom_label_contour" class="anchor"></a>geom_text_contour and geom_label_contour</h2>
<p>Labelling contours is also a problematic aspect of <code>ggplot2</code>. <code><a href="../reference/geom_text_contour.html">geom_text_contour()</a></code> and <code><a href="../reference/geom_text_contour.html">geom_label_contour()</a></code> can be use to automatically add text or labels to the flattest part of a contour.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lev</span> <span class="kw">==</span> <span class="fl">300</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">air.z</span>)) +
    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>() +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">geom_contour</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>) +
    <span class="fu"><a href="../reference/geom_text_contour.html">geom_text_contour</a></span>() +
    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_x_longitude</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_latitude</a></span>()
<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span>

<span class="co">#&gt; Warning in as.numeric(group[1]) %in% rot.groups: NAs introduced by coercion</span></pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>By default it labels every 2nd contour (this can be changed by the <code>skip</code> parameter) and it rotates to follow the angle of the contour (this is not available on <code><a href="../reference/geom_text_contour.html">geom_label_contour()</a></code>). Since in some datasets there can be very small contours that should not be labelled for clarity, the <code>min.size</code> argument specifies the minimum points a contour has to have in order to be labelled.</p>
<p>Notice how labels are drawn on top of contours? The problem is that <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">geom_contour()</a></code> doesn’t know it’s being labelled; <code><a href="../reference/geom_text_contour.html">geom_text_contour()</a></code> addresses this issue by allowing you to draw a stroke around the text.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lev</span> <span class="kw">==</span> <span class="fl">300</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">air.z</span>)) +
    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>() +
    <span class="fu"><a href="../reference/geom_contour2.html">geom_contour2</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="st">"black"</span>) +
    <span class="fu"><a href="../reference/geom_text_contour.html">geom_text_contour</a></span>(<span class="kw">stroke</span> <span class="kw">=</span> <span class="fl">0.2</span>) +
    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_x_longitude</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_latitude</a></span>()</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
</div>
<div id="geom_contour_tanaka" class="section level2">
<h2 class="hasAnchor">
<a href="#geom_contour_tanaka" class="anchor"></a>geom_contour_tanaka</h2>
<p>Illuminated contours (aka Tanaka contours) use varying brightness and width to create an illusion of relief. This can help distinguishing between concave and convex areas (local minimums and maximums), specially in black and white plots. It also allows for photocopy safe plots with divergent colour palettes, and it just looks cool.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lev</span> <span class="kw">==</span> <span class="fl">300</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">air.z</span>)) +
     <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>() +
     <span class="fu"><a href="../reference/geom_contour_tanaka.html">geom_contour_tanaka</a></span>() +
     <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span>() +
     <span class="fu"><a href="../reference/scale_longitude.html">scale_x_longitude</a></span>() +
     <span class="fu"><a href="../reference/scale_longitude.html">scale_y_latitude</a></span>()</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-8-1.png" width="672"></p>
</div>
<div id="stat_subset" class="section level2">
<h2 class="hasAnchor">
<a href="#stat_subset" class="anchor"></a>stat_subset</h2>
<p><code>metR</code> also has <code><a href="../reference/stat_subset.html">stat_subset()</a></code> which makes a subset of the data according to the <code>subset</code> aesthetic. This makes it possible to show only part of the data in one geom without needing to specify a <code>data</code> argument (specially useful if the data being plotted is the result of a long pipe and not actually assigned to a <code>data.frame</code>). It has a somewhat limited use in that it cannot perform further statistical transformations of the data.</p>
<p>For example, it can be used if you have a correlation field and want to mark only the points with significant correlations:</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="no">geopotential</span>)    <span class="co"># geopotential height at 700hPa for the southern hemisphere. </span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">geopotential</span>[, <span class="no">gh.base</span> <span class="kw">:=</span> <span class="no">gh</span>[<span class="no">lon</span> <span class="kw">==</span> <span class="fl">120</span> <span class="kw">&amp;</span> <span class="no">lat</span> <span class="kw">==</span> -<span class="fl">50</span>], <span class="kw">by</span> <span class="kw">=</span> <span class="no">date</span>][
    , <span class="fu">.</span>(<span class="kw">correlation</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span>(<span class="no">gh.base</span>, <span class="no">gh</span>)),
    <span class="kw">by</span> <span class="kw">=</span> <span class="fu">.</span>(<span class="no">lon</span>, <span class="no">lat</span>)],
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">correlation</span>)) +
    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="../reference/MakeBreaks.html">MakeBreaks</a></span>(<span class="fl">0.1</span>)) +
    <span class="fu"><a href="../reference/stat_subset.html">stat_subset</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">subset</span> <span class="kw">=</span> <span class="no">correlation</span> <span class="kw">&gt;</span> <span class="fl">0.5</span>),
                <span class="kw">geom</span> <span class="kw">=</span> <span class="st">"point"</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="fl">0.1</span>) +
    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_x_longitude</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_latitude</a></span>()</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>Another possible use it to quickly mask missing values.</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">v</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">Var1</span>, <span class="no">Var2</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">value.gap</span>)) +
    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="no">breaks</span>, <span class="kw">na.fill</span> <span class="kw">=</span> <span class="fl">TRUE</span>) +
    <span class="fu"><a href="../reference/stat_subset.html">stat_subset</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">subset</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span>(<span class="no">value.gap</span>)), <span class="kw">geom</span> <span class="kw">=</span> <span class="st">"raster"</span>,
                <span class="kw">fill</span> <span class="kw">=</span> <span class="st">"#EBEBEB"</span>)
<span class="co">#&gt; Warning: imputing missing values</span></pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
</div>
<div id="geom_vector-and-geom_arrow" class="section level2">
<h2 class="hasAnchor">
<a href="#geom_vector-and-geom_arrow" class="anchor"></a>geom_vector and geom_arrow</h2>
<p>Plotting arrows can be a pain. Again, the ‘canonical’ way of plotting vectors is to use <code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment()</a></code> and specify <code>x</code>, <code>y</code>, <code>xend</code> and <code>yend</code> aesthetics which can be a lot of typing when one has the data on location and displacement (or velocity). Instead, <code>metR</code>‘s <code><a href="../reference/geom_arrow.html">geom_vector()</a></code> and <code><a href="../reference/geom_arrow.html">geom_arrow()</a></code> draw vectors defined by their lateral displacements (dx, dy) or their magnitude and angle. It also has some useful parameters like <code>min.mag</code>, which controls the minimum magnitude for an arrow to be drawn (useful for highlighting only areas of strong ’flow’) and <code>skip</code>, which draws only the nth arrow in the x and y directions.</p>
<p>Both geoms are essentially the same, except that <code><a href="../reference/geom_arrow.html">geom_arrow()</a></code> defaults to preserving direction in coordinate transformations and regardless of the plot aspect ratio. This is recommended if the arrows are meant to convey the direction of the flow in each point instead of being a description of the shape of the flow related to the plot coordinates.</p>
<p>So, as an example, we can plot the temperature gradient like this:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">temperature</span>[, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"t.dx"</span>, <span class="st">"t.dy"</span>) <span class="kw">:=</span> <span class="fu"><a href="../reference/Derivate.html">Derivate</a></span>(<span class="no">air.z</span> ~ <span class="no">lon</span> + <span class="no">lat</span>,
                                            <span class="kw">cyclical</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">TRUE</span>, <span class="fl">FALSE</span>)),
            <span class="kw">by</span> <span class="kw">=</span> <span class="no">lev</span>]

(<span class="no">g</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lev</span> <span class="kw">==</span> <span class="fl">500</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lat</span>)) +
    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">z</span> <span class="kw">=</span> <span class="no">air.z</span>)) +
    <span class="fu"><a href="../reference/geom_arrow.html">geom_vector</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">dx</span> <span class="kw">=</span> <span class="no">t.dx</span>, <span class="kw">dy</span> <span class="kw">=</span> <span class="no">t.dy</span>), <span class="kw">skip.x</span> <span class="kw">=</span> <span class="fl">2</span>,
                <span class="kw">skip.y</span> <span class="kw">=</span> <span class="fl">1</span>) +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_latitude</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">90</span>, <span class="fl">0</span>)) +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_x_longitude</a></span>() +
    <span class="fu"><a href="../reference/scale_mag.html">scale_mag</a></span>())</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>In the above example, t.dx and t.dy represent displacements in the same units as the x and y dimension, so using <code><a href="../reference/geom_arrow.html">geom_vector()</a></code> each arrow points perpendicular to the contours even if we change the coordinate system.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">g</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span>()</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>But if we want to plot how the (horizontal) direction changes with height it makes more sense to use <code><a href="../reference/geom_arrow.html">geom_arrow()</a></code> (or <code><a href="../reference/geom_arrow.html">geom_vector(preserve.dir = TRUE)</a></code>)</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lon</span> <span class="kw">%between%</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">100</span>, <span class="fl">200</span>) <span class="kw">&amp;</span> <span class="no">lat</span> <span class="kw">==</span> -<span class="fl">50</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lev</span>)) +
    <span class="fu"><a href="../reference/geom_arrow.html">geom_arrow</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">dx</span> <span class="kw">=</span> <span class="fu"><a href="../reference/spherical.html">dx</a></span>(<span class="no">t.dx</span>, <span class="no">lat</span>), <span class="kw">dy</span> <span class="kw">=</span> <span class="fu"><a href="../reference/spherical.html">dy</a></span>(<span class="no">t.dy</span>)), <span class="kw">skip</span> <span class="kw">=</span> <span class="fl">1</span>) +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_level</a></span>() +
    <span class="fu"><a href="../reference/scale_mag.html">scale_mag</a></span>()</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<p>In this case, an arrow at a 45° angle represents temperature gradient from the southwest regardless of the <code>x</code> and <code>y</code> scales.</p>
<p>The <code>start</code> and <code>direction</code> arguments adjust the behaviour of the arrows. This is useful for working with winds in the meteorological standard (in which 0° means wind from the North and 90° means wind from the East).</p>
</div>
<div id="geom_streamline" class="section level2">
<h2 class="hasAnchor">
<a href="#geom_streamline" class="anchor"></a>geom_streamline</h2>
<p>Streamlines are paths tangential to a vector field and provide an intuitive way of visualizing vector fields. <code><a href="../reference/geom_streamline.html">geom_streamline()</a></code> computes streamlines via Euler integration.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r">(<span class="no">g</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lev</span> <span class="kw">==</span> <span class="fl">500</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lat</span>)) +
     <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">z</span> <span class="kw">=</span> <span class="no">air.z</span>)) +
     <span class="fu"><a href="../reference/geom_streamline.html">geom_streamline</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">dx</span> <span class="kw">=</span> <span class="no">t.dy</span>, <span class="kw">dy</span> <span class="kw">=</span> -<span class="no">t.dx</span>), <span class="kw">L</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">res</span> <span class="kw">=</span> <span class="fl">2</span>,
                     <span class="kw">arrow.length</span> <span class="kw">=</span> <span class="fl">0.3</span>, <span class="kw">xwrap</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">360</span>)) +
     <span class="fu"><a href="../reference/scale_longitude.html">scale_y_latitude</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">90</span>, <span class="fl">0</span>)) +
     <span class="fu"><a href="../reference/scale_longitude.html">scale_x_longitude</a></span>())</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>There are several parameters that control the feel of the result. <code>L</code> and <code>res</code> control the length and resolution, while the <code>skip</code> parameters change the amount of the streamlines. More in depth control over the simulation can be accomplished by the <code>S</code> and <code>dt</code> parameters.</p>
<p>Since streamlines imply a tight relationship between the vector field and the spatial dimensions, it’s important that their units are compatible. A wind field in m/s in a longitude-latitude grid should first be converted into degrees/s. The functions <code><a href="../reference/spherical.html">dlon()</a></code> and <code><a href="../reference/spherical.html">dlat()</a></code> are an easy way of doing this. This tight coupling also means that they are robust to coordinate transformations.</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">g</span> + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_polar.html">coord_polar</a></span>()</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-15-1.png" width="672"></p>
<p><code><a href="../reference/geom_streamline.html">stat_streamline()</a></code> computes three useful variables. <code>step</code> is the integration step, and <code>dx</code> and <code>dy</code> are the components of the vector field at each point. They can be used to visualize information about the field in each point, and to give a sense of direction without arrows.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lev</span> <span class="kw">==</span> <span class="fl">500</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lat</span>)) +
    <span class="fu"><a href="../reference/geom_streamline.html">geom_streamline</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">dx</span> <span class="kw">=</span> <span class="no">t.dy</span>, <span class="kw">dy</span> <span class="kw">=</span> -<span class="no">t.dx</span>, <span class="kw">size</span> <span class="kw">=</span> <span class="no">..step..</span>, <span class="kw">alpha</span> <span class="kw">=</span> <span class="no">..step..</span>,
                        <span class="kw">color</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span>(<span class="no">..dx..</span>^<span class="fl">2</span> + <span class="no">..dy..</span>^<span class="fl">2</span>)), <span class="kw">arrow</span> <span class="kw">=</span> <span class="kw">NULL</span>,
                    <span class="kw">L</span> <span class="kw">=</span> <span class="fl">10</span>, <span class="kw">res</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">xwrap</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">360</span>), <span class="kw">lineend</span> <span class="kw">=</span> <span class="st">"round"</span>) +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_latitude</a></span>(<span class="kw">limits</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(-<span class="fl">90</span>, <span class="fl">0</span>)) +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_x_longitude</a></span>() +
    <span class="kw pkg">viridis</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/viridis/man/scale_viridis.html">scale_color_viridis</a></span>(<span class="kw">guide</span> <span class="kw">=</span> <span class="st">"none"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_size.html">scale_size</a></span>(<span class="kw">range</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="fl">1</span>), <span class="kw">guide</span> <span class="kw">=</span> <span class="st">"none"</span>) +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_alpha.html">scale_alpha</a></span>(<span class="kw">guide</span> <span class="kw">=</span> <span class="st">"none"</span>)</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-16-1.png" width="672"></p>
</div>
</div>
<div id="other-goodies" class="section level1">
<h1 class="hasAnchor">
<a href="#other-goodies" class="anchor"></a>Other goodies</h1>
<div id="guide_colorstrip" class="section level2">
<h2 class="hasAnchor">
<a href="#guide_colorstrip" class="anchor"></a>guide_colorstrip</h2>
<p>The use of <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">geom_contour()</a></code> and <code><a href="../reference/geom_contour_fill.html">geom_contour_fill()</a></code> generates a problem because those geoms implicitly discretize a continuous variable, but the default guide (<code><a href="https://ggplot2.tidyverse.org/reference/guide_colourbar.html">guide_colourbar()</a></code>) still show a continuous scale. This can be partially solved by using <code>ggplot</code>’s <code><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html">guide_legend()</a></code></p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lev</span> <span class="kw">==</span> <span class="fl">300</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">air.z</span>)) +
    <span class="fu"><a href="../reference/geom_contour2.html">geom_contour2</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">color</span> <span class="kw">=</span> <span class="no">..level..</span>), <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="../reference/MakeBreaks.html">MakeBreaks</a></span>(<span class="fl">2</span>)) +
    <span class="fu"><a href="../reference/scale_divergent.html">scale_color_divergent</a></span>(<span class="kw">guide</span> <span class="kw">=</span> <span class="st">"legend"</span>,
                          <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="../reference/MakeBreaks.html">MakeBreaks</a></span>(<span class="fl">2</span>)) +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_x_longitude</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_latitude</a></span>() + <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-17-1.png" width="672"></p>
<p>This has some limitations as can be seen above. First, in the case of <code><a href="https://ggplot2.tidyverse.org/reference/geom_contour.html">geom_contour()</a></code> the full colour scale is replaced by lines. Second, it breaks down if the position of the legend is at the bottom. Finally, the listed colours are the ones mapped to the breaks, which can be a problem in the case of <code><a href="../reference/geom_contour_fill.html">geom_contour_fill()</a></code> in which the colours are actually the values <em>between</em> breaks.</p>
<p>All of these problems are solved in <code><a href="../reference/guide_colourstrip.html">guide_colorstrip()</a></code> as can be seen in the figure below.</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">temperature</span>[<span class="no">lev</span> <span class="kw">==</span> <span class="fl">300</span>], <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">lon</span>, <span class="no">lat</span>, <span class="kw">z</span> <span class="kw">=</span> <span class="no">air.z</span>)) +
    <span class="fu"><a href="../reference/geom_contour_fill.html">geom_contour_fill</a></span>(<span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="../reference/MakeBreaks.html">MakeBreaks</a></span>(<span class="fl">2</span>)) +
    <span class="fu"><a href="../reference/scale_divergent.html">scale_fill_divergent</a></span>(<span class="kw">guide</span> <span class="kw">=</span> <span class="st">"colorstrip"</span>,
                         <span class="kw">breaks</span> <span class="kw">=</span> <span class="fu"><a href="../reference/MakeBreaks.html">MakeBreaks</a></span>(<span class="fl">2</span>)) +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_x_longitude</a></span>() +
    <span class="fu"><a href="../reference/scale_longitude.html">scale_y_latitude</a></span>() +
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span>(<span class="kw">legend.position</span> <span class="kw">=</span> <span class="st">"bottom"</span>)</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
<p>By default, colours are mapped to the values <em>in between</em> breaks, so there’s a one-to-one mapping between colours shown in the plot and in the guide. From an aesthetic standpoint, it’s much closer to the <code>cbarn</code> command from <code>GrADS</code>, which a lot of atmospheric scientists are probably used to.</p>
</div>
<div id="geom_relief" class="section level2">
<h2 class="hasAnchor">
<a href="#geom_relief" class="anchor"></a>geom_relief</h2>
<p>This geom produces a shaded relief of the data. It doesn’t really map the data per se, but it provides an intuitive representation of hills and valleys that can be used as a background for plotting actual data.</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span>(<span class="no">v</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="no">Var1</span>, <span class="no">Var2</span>)) +
    <span class="fu"><a href="../reference/geom_relief.html">geom_relief</a></span>(<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span>(<span class="kw">z</span> <span class="kw">=</span> <span class="no">value</span>))</pre></body></html></div>
<p><img src="Visualization-tools_files/figure-html/unnamed-chunk-19-1.png" width="672"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Elio Campitelli.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
